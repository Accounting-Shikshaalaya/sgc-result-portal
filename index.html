<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Result Viewer</title>
  <style>
    body { font-family: Arial; padding: 20px; background-color: #f9f9f9; }
    h2 { color: #004080; }
    label { display: block; margin-top: 15px; }
    input, select, button { padding: 10px; margin-top: 5px; width: 100%; max-width: 400px; }
    #loading { color: green; margin-top: 15px; }
    #resultLink { margin-top: 15px; }
  </style>
</head>
<body>
  <h2>Student Result Portal</h2>
  
  <label>Enter Roll Number:</label>
  <input type="text" id="roll" placeholder="e.g. 101">

  <label>Select Class Year:</label>
  <select id="classYear">
    <option value="Hons. 1st Year">Hons. 1st Year</option>
    <option value="Hons. 2nd Year">Hons. 2nd Year</option>
    <option value="Hons. 3rd Year">Hons. 3rd Year</option>
    <option value="Hons. Final Year">Hons. Final Year</option>
  </select>

  <label>Verification Code:</label>
  <input type="text" id="captcha" placeholder="Type this: ABC123">
  
  <button onclick="getResult()">Submit</button>

  <div id="loading"></div>
  <div id="resultLink"></div>

  <script>
    const expected = "ABC123";

    async function getResult() {
      const roll = document.getElementById("roll").value.trim();
      const classYear = document.getElementById("classYear").value;
      const captcha = document.getElementById("captcha").value.trim();

      if (!roll || !captcha) {
        alert("Please fill in all fields.");
        return;
      }

      const loadingDiv = document.getElementById("loading");
      const resultDiv = document.getElementById("resultLink");
      loadingDiv.innerText = "Generating result, please wait...";
      resultDiv.innerHTML = "";

      const payload = {
        roll,
        classYear,
        captcha,
        expectedCaptcha: expected
      };

      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbxiHLQ5Y3A3bjsTtwq9LEFl2ZFAIYBJn8jtTkw2xnkBo_7ueb5QeDY323BZTs3usiRkfg/exec", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        const result = await response.json();
        loadingDiv.innerText = "";

        if (result.status === "success") {
          resultDiv.innerHTML = `<a href="${result.pdfUrl}" target="_blank">ðŸ“„ Download PDF Result</a>`;
        } else {
          resultDiv.innerHTML = `<span style="color:red;">${result.message}</span>`;
        }

      } catch (err) {
        loadingDiv.innerText = "";
        alert("Server error: " + err.message);
      }
    }
  </script>
</body>
</html>
